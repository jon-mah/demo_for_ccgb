#   '../SupplementaryAnalysis/Bacteroides_coprocola_61586/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Barnesiella_intestinihominis_62208/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Akkermansia_muciniphila_55290/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Dialister_invisus_61905/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Phascolarctobacterium_sp_59817/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Eubacterium_eligens_61678/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Lachnospiraceae_bacterium_51870/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Roseburia_inulinivorans_61943/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Eubacterium_rectale_56927/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Coprococcus_sp_62244/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Oscillibacter_sp_60799/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Ruminococcus_bromii_62047/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Eubacterium_siraeum_57634/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Ruminococcus_bicirculans_59300/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Faecalibacterium_prausnitzii_57453/core_inferred_DFE.txt',
#   '../SupplementaryAnalysis/Faecalibacterium_prausnitzii_61481/core_inferred_DFE.txt'
# )
# fd_no_outlier_mean_s = numeric(37)
# fd_no_outlier_n_anc = numeric(37)
# fd_no_outlier_proportion_neutrality = numeric(37)
# fd_no_outlier_shape = numeric(37)
# for (i in 1:length(fd_no_outlier_dfe_file_list)) {
#   fd_no_outlier_mean_s[i] = compute_selection_coefficients(fd_no_outlier_dfe_file_list[i])[1]
#   fd_no_outlier_n_anc[i] = nanc_from_demography(fd_no_outlier_demography_file_list[i])
#   fd_no_outlier_proportion_neutrality[i] = compute_selection_coefficients(fd_no_outlier_dfe_file_list[i])[2]
#   fd_no_outlier_shape[i] = return_shape_from_dfe(fd_no_outlier_dfe_file_list[i])
# }
#
# FD_no_outlier_data = data.frame(
#   species=fd_no_outlier_species,
#   mean_s=fd_no_outlier_mean_s,
#   n_anc=fd_no_outlier_n_anc,
#   proportion_neutrality=fd_no_outlier_proportion_neutrality,
#   shape=fd_no_outlier_shape
# )
#
# FD_no_outlier_data$mean_2ns = fd_no_outlier_mean_s * fd_no_outlier_n_anc * 2
#
# FD_no_outlier_data = FD_no_outlier_data[match(FD_no_outlier_subtree$tip.label, FD_no_outlier_data$species),]
#
# FD_no_outlier_data = FD_no_outlier_data[, -c(1)]
#
# FD_no_outlier_phylo_4d = phylo4d(FD_no_outlier_subtree, FD_no_outlier_data, match.data=TRUE)
#
# phyloSignal(FD_no_outlier_phylo_4d)
# FD_no_outlier_phylosim <- phyloSim(tree = FD_no_outlier_subtree, method = "all", nsim = 100, reps = 99)
# plot(FD_no_outlier_phylosim, stacked.methods = FALSE, quantiles = c(0.05, 0.95))
# plot(phyloCorrelogram(FD_no_outlier_phylo_4d, trait = 'mean_s'), main='Phylogenetic correlogram of mean selection coefficient')
# plot(phyloCorrelogram(FD_no_outlier_phylo_4d, trait = 'n_anc'), main='Phylogenetic correlogram of ancestral effective population size')
# plot(phyloCorrelogram(FD_no_outlier_phylo_4d, trait = 'mean_2ns'), main='Phylogenetic correlogram of mean population-scaled selection coefficient')
# plot(phyloCorrelogram(FD_no_outlier_phylo_4d, trait = 'proportion_neutrality'), main='Phylogenetic correlogram of proportion of neutrality')
# plot(phyloCorrelogram(FD_no_outlier_phylo_4d, trait = 'shape'), main='Phylogenetic correlogram of Gamma-distributed DFE shape parameter')
# barplot(FD_no_outlier_phylo_4d, center=FALSE, scale=FALSE)
#
# barplot(FD_no_outlier_phylo_4d)
# Comparison of Mean s
# Plot DFE Grid
mean_s_file_list = c(
'../SupplementaryAnalysis/Alistipes_sp_60764/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_putredinis_61533/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Odoribacter_splanchnicus_62174/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Prevotella_copri_61740/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_fragilis_54507/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_eggerthii_54457/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_uniformis_57318/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_xylanisolvens_57185/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_plebeius_61623/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_coprocola_61586/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Barnesiella_intestinihominis_62208/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Akkermansia_muciniphila_55290/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Phascolarctobacterium_sp_59817/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Roseburia_inulinivorans_61943/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Roseburia_intestinalis_56239/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Lachnospiraceae_bacterium_51870/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Coprococcus_sp_62244/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Oscillibacter_sp_60799/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Ruminococcus_bicirculans_59300/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_57453/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_62201/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_61481/core_inferred_DFE.txt'
)
mean_s_comparison_matrix = matrix(, nrow=39, ncol=39)
for (i in 1:39) {
for (j in i:39) {  # This change ensures only the upper right triangle is compared
mean_i = compute_selection_coefficients(mean_s_file_list[i])[1]
mean_j = compute_selection_coefficients(mean_s_file_list[j])[1]
comparison = abs(mean_i - mean_j)
mean_s_comparison_matrix[i, j] = comparison
mean_s_comparison_matrix[j, i] = comparison  # Mirror the value across the diagonal
}
}
core_within_genera_mean_s = c()
core_within_genera_mean_s = c(core_within_genera_mean_s, mean_s_comparison_matrix[FD_alistipes, FD_alistipes][lower.tri(mean_s_comparison_matrix[FD_alistipes, FD_alistipes])])
core_within_genera_mean_s = c(core_within_genera_mean_s, mean_s_comparison_matrix[FD_bacteroides, FD_bacteroides][lower.tri(mean_s_comparison_matrix[FD_bacteroides, FD_bacteroides])])
core_within_genera_mean_s = c(core_within_genera_mean_s, mean_s_comparison_matrix[FD_eubacterium, FD_eubacterium][lower.tri(mean_s_comparison_matrix[FD_eubacterium, FD_eubacterium])])
core_within_genera_mean_s = c(core_within_genera_mean_s, mean_s_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium][lower.tri(mean_s_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium])])
core_within_genera_mean_s = c(core_within_genera_mean_s, mean_s_comparison_matrix[FD_parabacteroides, FD_parabacteroides][lower.tri(mean_s_comparison_matrix[FD_parabacteroides, FD_parabacteroides])])
core_within_genera_mean_s = c(core_within_genera_mean_s, mean_s_comparison_matrix[FD_roseburia, FD_roseburia][lower.tri(mean_s_comparison_matrix[FD_roseburia, FD_roseburia])])
core_within_genera_mean_s = c(core_within_genera_mean_s, mean_s_comparison_matrix[FD_ruminococcus, FD_ruminococcus][lower.tri(mean_s_comparison_matrix[FD_ruminococcus, FD_ruminococcus])])
length(core_within_genera_mean_s) # 85 total within-genera comparisons
core_between_genera_mean_s = mean_s_comparison_matrix[lower.tri(mean_s_comparison_matrix)][!mean_s_comparison_matrix[lower.tri(mean_s_comparison_matrix)] %in% core_within_genera_mean_s]
mean_s_list <- melt(list(within_genera = core_within_genera_mean_s, between_genera = core_between_genera_mean_s))
between_within_mean_s_diff = abs(mean(core_between_genera_mean_s) - mean(core_within_genera_mean_s))
permutation_mean_s_diff = numeric(100000)
for (i in 1:100000) {
this_scramble_between = sample(mean_s_list$value, size=656, replace=FALSE)
this_scramble_within = sample(mean_s_list$value, size=85, replace=FALSE)
permutation_mean_s_diff[i] = abs(mean(this_scramble_between) - mean(this_scramble_within))
}
permutation_mean_s_data = data.frame(permutation_mean_s_diff)
names(permutation_mean_s_data) = c('value')
sum(between_within_mean_s_diff > permutation_mean_s_data) / 100000
quantile_label = "Proportion of area:"
quantile_label = paste(quantile_label, sum(between_within_mean_s_diff > permutation_mean_s_data) / 100000, sep=' ')
permutation_mean_s = ggplot(permutation_mean_s_data, aes(x=value, y=..count..)) +
geom_histogram(bins=100) +
xlab('Absolute difference of mean selection coefficient') +
ylab('Number of simulations') +
geom_vline(xintercept = between_within_mean_s_diff, color='green', linetype='dotted', linewidth=3) +
theme_minimal() +
ggtitle('Simulated absolute difference of mean selection coefficients') +
annotate("text", x=0.04, y=3500, label= quantile_label, size=5) +
theme(axis.title=element_text(size=18)) +
theme(plot.title=element_text(size=20))
ggsave('../Summary/permutation_mean_s.svg', permutation_mean_s, width=18, height=12, dpi=600)
set.seed(1)
mean_s_scramble_within_genera = sample(mean_s_list$value, size=85, replace=FALSE)
mean_s_scramble_between_genera = sample(mean_s_list$value, size=656, replace=FALSE)
mean_s_list <- melt(
list(
within_genera = core_within_genera_mean_s, between_genera = core_between_genera_mean_s, scrambled_within = mean_s_scramble_within_genera, scrambled_between = mean_s_scramble_between_genera
)
)
mean_s_list$L1 = factor(mean_s_list$L1, levels=c('between_genera', 'within_genera', 'scrambled_between', 'scrambled_within'))
mean_s_LRT_distribution = ggplot(mean_s_list, aes(x=L1, y=value, fill=L1)) +
geom_boxplot() +
ylab('Absolute value of difference') +
xlab('Comparison') +
scale_fill_manual(labels=c('Between-genera', 'Within-genera', 'Permutation test (within)', 'Permutation test (between)'),
breaks=c('between_genera', 'within_genera', 'scrambled_within', 'scrambled_between'),
values=c("#69b3a2", "#95fd34", 'black', 'grey'),) +
theme_minimal() +
theme(axis.text.x=element_blank(),) +
guides(fill=guide_legend(title="Type of DFE comparison")) +
ggtitle('Absolute difference in mean selection coefficient for between-genera and within-genera DFE comparisons') +
geom_signif(position='identity', y_position=0.75,
comparisons = comparison_1, size=1,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', y_position=0.83,
comparisons = comparison_2, size=1,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', size=1,
comparisons = comparison_3, y_position=0.91,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', size=1,
comparisons = comparison_4, y_position=0.99,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
theme(axis.title=element_text(size=18)) +
theme(plot.title=element_text(size=20)) +
theme(legend.title=element_text(size=18)) +
theme(legend.text=element_text(size=16))
ggsave('../Summary/mean_s_LRT_distribution.svg', mean_s_LRT_distribution, width=18, height=12, dpi=600)
mean_2ns_demography_list = c(
'../SupplementaryAnalysis/Alistipes_sp_60764/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_putredinis_61533/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/two_epoch_demography.txt',
'../SupplementaryAnalysis/Odoribacter_splanchnicus_62174/two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/two_epoch_demography.txt',
'../SupplementaryAnalysis/Prevotella_copri_61740/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_fragilis_54507/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_eggerthii_54457/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_uniformis_57318/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_xylanisolvens_57185/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_plebeius_61623/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_coprocola_61586/two_epoch_demography.txt',
'../SupplementaryAnalysis/Barnesiella_intestinihominis_62208/two_epoch_demography.txt',
'../SupplementaryAnalysis/Akkermansia_muciniphila_55290/two_epoch_demography.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/two_epoch_demography.txt',
'../SupplementaryAnalysis/Phascolarctobacterium_sp_59817/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/two_epoch_demography.txt',
'../SupplementaryAnalysis/Roseburia_inulinivorans_61943/two_epoch_demography.txt',
'../SupplementaryAnalysis/Roseburia_intestinalis_56239/two_epoch_demography.txt',
'../SupplementaryAnalysis/Lachnospiraceae_bacterium_51870/two_epoch_demography.txt',
'../SupplementaryAnalysis/Coprococcus_sp_62244/two_epoch_demography.txt',
'../SupplementaryAnalysis/Oscillibacter_sp_60799/two_epoch_demography.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/two_epoch_demography.txt',
'../SupplementaryAnalysis/Ruminococcus_bicirculans_59300/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/two_epoch_demography.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_57453/two_epoch_demography.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_62201/two_epoch_demography.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_61481/two_epoch_demography.txt'
)
mean_2ns_dfe_list = c(
'../SupplementaryAnalysis/Alistipes_sp_60764/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Alistipes_putredinis_61533/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Odoribacter_splanchnicus_62174/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Prevotella_copri_61740/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_fragilis_54507/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_eggerthii_54457/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_uniformis_57318/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_xylanisolvens_57185/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_plebeius_61623/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Bacteroides_coprocola_61586/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Barnesiella_intestinihominis_62208/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Akkermansia_muciniphila_55290/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Phascolarctobacterium_sp_59817/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Roseburia_inulinivorans_61943/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Roseburia_intestinalis_56239/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Lachnospiraceae_bacterium_51870/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Coprococcus_sp_62244/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Oscillibacter_sp_60799/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Ruminococcus_bicirculans_59300/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_57453/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_62201/core_inferred_DFE.txt',
'../SupplementaryAnalysis/Faecalibacterium_prausnitzii_61481/core_inferred_DFE.txt'
)
mean_2ns_comparison_matrix = matrix(, nrow=39, ncol=39)
for (i in 1:39) {
for (j in i:39) {  # This change ensures only the upper right triangle is compared
mean_i = compute_selection_coefficients(mean_2ns_dfe_list[i])[1]
mean_j = compute_selection_coefficients(mean_2ns_dfe_list[j])[1]
nanc_i = nanc_from_demography(mean_2ns_demography_list[i])
nanc_j = nanc_from_demography(mean_2ns_demography_list[j])
mean_2ns_i = 2 * mean_i * nanc_i
mean_2ns_j = 2 * mean_j * nanc_j
comparison = abs(mean_2ns_i - mean_2ns_j)
mean_2ns_comparison_matrix[i, j] = comparison
mean_2ns_comparison_matrix[j, i] = comparison  # Mirror the value across the diagonal
}
}
core_within_genera_mean_2ns = c()
core_within_genera_mean_2ns = c(core_within_genera_mean_2ns, mean_2ns_comparison_matrix[FD_alistipes, FD_alistipes][lower.tri(mean_2ns_comparison_matrix[FD_alistipes, FD_alistipes])])
core_within_genera_mean_2ns = c(core_within_genera_mean_2ns, mean_2ns_comparison_matrix[FD_bacteroides, FD_bacteroides][lower.tri(mean_2ns_comparison_matrix[FD_bacteroides, FD_bacteroides])])
core_within_genera_mean_2ns = c(core_within_genera_mean_2ns, mean_2ns_comparison_matrix[FD_eubacterium, FD_eubacterium][lower.tri(mean_2ns_comparison_matrix[FD_eubacterium, FD_eubacterium])])
core_within_genera_mean_2ns = c(core_within_genera_mean_2ns, mean_2ns_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium][lower.tri(mean_2ns_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium])])
core_within_genera_mean_2ns = c(core_within_genera_mean_2ns, mean_2ns_comparison_matrix[FD_parabacteroides, FD_parabacteroides][lower.tri(mean_2ns_comparison_matrix[FD_parabacteroides, FD_parabacteroides])])
core_within_genera_mean_2ns = c(core_within_genera_mean_2ns, mean_2ns_comparison_matrix[FD_roseburia, FD_roseburia][lower.tri(mean_2ns_comparison_matrix[FD_roseburia, FD_roseburia])])
core_within_genera_mean_2ns = c(core_within_genera_mean_2ns, mean_2ns_comparison_matrix[FD_ruminococcus, FD_ruminococcus][lower.tri(mean_2ns_comparison_matrix[FD_ruminococcus, FD_ruminococcus])])
length(core_within_genera_mean_2ns) # 85 total within-genera comparisons
core_between_genera_mean_2ns = mean_2ns_comparison_matrix[lower.tri(mean_2ns_comparison_matrix)][!mean_2ns_comparison_matrix[lower.tri(mean_2ns_comparison_matrix)] %in% core_within_genera_mean_2ns]
mean_2ns_list <- melt(list(within_genera = core_within_genera_mean_2ns, between_genera = core_between_genera_mean_2ns))
between_within_mean_2ns_diff = abs(mean(core_between_genera_mean_2ns) - mean(core_within_genera_mean_2ns))
permutation_mean_2ns_diff = numeric(100000)
for (i in 1:100000) {
this_scramble_between = sample(mean_2ns_list$value, size=656, replace=FALSE)
this_scramble_within = sample(mean_2ns_list$value, size=85, replace=FALSE)
permutation_mean_2ns_diff[i] = abs(mean(this_scramble_between) - mean(this_scramble_within))
}
permutation_mean_2ns_data = data.frame(permutation_mean_2ns_diff)
names(permutation_mean_2ns_data) = c('value')
sum(between_within_mean_2ns_diff > permutation_mean_2ns_data) / 100000
quantile_label = "Proportion of area:"
quantile_label = paste(quantile_label, sum(between_within_mean_2ns_diff > permutation_mean_2ns_data) / 100000, sep=' ')
permutation_mean_2ns = ggplot(permutation_mean_2ns_data, aes(x=value, y=..count..)) +
geom_histogram(bins=100) +
xlab('Absolute difference of mean population-scale selection coefficient') +
ylab('Number of simulations') +
geom_vline(xintercept = between_within_mean_2ns_diff, color='green', linetype='dotted', linewidth=3) +
theme_minimal() +
ggtitle('Simulated difference of mean population-scaled selection coefficients') +
annotate("text", x=3E6, y=3500, label= quantile_label, size=5) +
theme(axis.title=element_text(size=18)) +
theme(plot.title=element_text(size=20))
ggsave('../Summary/permutation_mean_2ns.svg', permutation_mean_2ns, width=18, height=12, dpi=600)
set.seed(1)
mean_2ns_scramble_within_genera = sample(mean_2ns_list$value, size=85, replace=FALSE)
mean_2ns_scramble_between_genera = sample(mean_2ns_list$value, size=656, replace=FALSE)
mean_2ns_list <- melt(
list(
within_genera = core_within_genera_mean_2ns, between_genera = core_between_genera_mean_2ns, scrambled_within = mean_2ns_scramble_within_genera, scrambled_between = mean_2ns_scramble_between_genera
)
)
mean_2ns_list$L1 = factor(mean_2ns_list$L1, levels=c('between_genera', 'within_genera', 'scrambled_between', 'scrambled_within'))
mean_2ns_LRT_distribution = ggplot(mean_2ns_list, aes(x=L1, y=value, fill=L1)) +
geom_boxplot() +
ylab('Absolute value of difference') +
xlab('Comparison') +
scale_fill_manual(labels=c('Between-genera', 'Within-genera', 'Permutation test (within)', 'Permutation test (between)'),
breaks=c('between_genera', 'within_genera', 'scrambled_within', 'scrambled_between'),
values=c("#69b3a2", "#95fd34", 'black', 'grey'),) +
theme_minimal() +
theme(axis.text.x=element_blank(),) +
guides(fill=guide_legend(title="Type of DFE comparison")) +
ggtitle('Absolute difference in mean population-scaled selection coefficient for between-genera and within-genera DFE comparisons') +
geom_signif(position='identity', y_position=7E7,
comparisons = comparison_1, size=1,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', size=1, y_position=7.5E7,
comparisons = comparison_2,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', size=1,
comparisons = comparison_3, y_position=8E7,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', size=1,
comparisons = comparison_4, y_position=8.5E7,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
theme(axis.title=element_text(size=18)) +
theme(plot.title=element_text(size=20)) +
theme(legend.title=element_text(size=18)) +
theme(legend.text=element_text(size=16))
ggsave('../Summary/mean_2ns_LRT_distribution.svg', mean_2ns_LRT_distribution, width=18, height=12, dpi=600)
LRT_box_and_whiskers = LRT_distribution +
mean_s_LRT_distribution + theme(legend.position = 'none') +
mean_2ns_LRT_distribution + theme(legend.position = 'none') + plot_layout(ncol=1)
ggsave('../Summary/LRT_box_and_whiskers.svg', LRT_box_and_whiskers, width=18, height=36, dpi=600)
LRT_full_figure = LRT_distribution + permutation_LRT +
mean_s_LRT_distribution + theme(legend.position = 'none') + permutation_mean_s +
mean_2ns_LRT_distribution + theme(legend.position = 'none') + permutation_mean_2ns +
plot_layout(ncol=2)
ggsave('../Summary/LRT_full_figure.svg', LRT_full_figure, width=36, height=36, dpi=600)
# Fraction of sites remaining
survival_curve_file_list = c(
'../HighRecombinationAnalysis/Akkermansia_muciniphila_55290/survival_curve.csv',
'../HighRecombinationAnalysis/Alistipes_finegoldii_56071/survival_curve.csv',
'../HighRecombinationAnalysis/Alistipes_onderdonkii_55464/survival_curve.csv',
'../HighRecombinationAnalysis/Alistipes_shahii_62199/survival_curve.csv',
'../HighRecombinationAnalysis/Bacteroides_caccae_53434/survival_curve.csv',
'../HighRecombinationAnalysis/Bacteroides_cellulosilyticus_58046/survival_curve.csv',
'../HighRecombinationAnalysis/Bacteroides_fragilis_54507/survival_curve.csv',
'../HighRecombinationAnalysis/Bacteroides_stercoris_56735/survival_curve.csv',
'../HighRecombinationAnalysis/Bacteroides_thetaiotaomicron_56941/survival_curve.csv',
'../HighRecombinationAnalysis/Bacteroides_vulgatus_57955/survival_curve.csv',
'../HighRecombinationAnalysis/Barnesiella_intestinihominis_62208/survival_curve.csv',
'../HighRecombinationAnalysis/Dialister_invisus_61905/survival_curve.csv',
'../HighRecombinationAnalysis/Eubacterium_rectale_56927/survival_curve.csv',
'../HighRecombinationAnalysis/Oscillibacter_sp_60799/survival_curve.csv',
'../HighRecombinationAnalysis/Parabacteroides_distasonis_56985/survival_curve.csv',
'../HighRecombinationAnalysis/Parabacteroides_merdae_56972/survival_curve.csv',
'../HighRecombinationAnalysis/Ruminococcus_bicirculans_59300/survival_curve.csv',
'../HighRecombinationAnalysis/Ruminococcus_bromii_62047/survival_curve.csv'
)
survival_curve_fraction_list = c()
for (i in 1:length(survival_curve_file_list)) {
this_table = read.csv(survival_curve_file_list[i])
this_fraction = this_table$Remaining.sites[50] / this_table$Remaining.sites[1]
survival_curve_fraction_list = c(survival_curve_fraction_list, this_fraction)
}
num_iLDS_peaks = read.csv('../HighRecombinationData/num_iLDS_peaks.csv')
# temp_table = read.csv(survival_curve_file_list[1])
FD_core_accessory_dadi_DFE_reduced = a_putredinis_fd_core_dadi_dfe_plot + a_finegoldii_fd_core_dadi_dfe_plot +
a_putredinis_fd_accessory_dadi_dfe_plot + a_finegoldii_fd_accessory_dadi_dfe_plot +
a_onderdonkii_fd_core_dadi_dfe_plot + a_shahii_fd_core_dadi_dfe_plot +
a_onderdonkii_fd_accessory_dadi_dfe_plot + a_shahii_fd_accessory_dadi_dfe_plot +
b_bacterium_fd_core_dadi_dfe_plot + p_distasonis_fd_core_dadi_dfe_plot +
b_bacterium_fd_accessory_dadi_dfe_plot + p_distasonis_fd_accessory_dadi_dfe_plot +
p_merdae_fd_core_dadi_dfe_plot + b_cellulosilyticus_fd_core_dadi_dfe_plot +
p_merdae_fd_accessory_dadi_dfe_plot + b_cellulosilyticus_fd_accessory_dadi_dfe_plot +
b_stercoris_fd_core_dadi_dfe_plot + b_thetaiotaomicron_fd_core_dadi_dfe_plot +
b_stercoris_fd_accessory_dadi_dfe_plot + b_thetaiotaomicron_fd_accessory_dadi_dfe_plot +
b_caccae_fd_core_dadi_dfe_plot + b_massiliensis_fd_core_dadi_dfe_plot +
b_caccae_fd_accessory_dadi_dfe_plot + b_massiliensis_fd_accessory_dadi_dfe_plot +
b_vulgatus_fd_core_dadi_dfe_plot + d_invisus_fd_core_dadi_dfe_plot +
b_vulgatus_fd_accessory_dadi_dfe_plot + d_invisus_fd_accessory_dadi_dfe_plot +
e_eligens_fd_core_dadi_dfe_plot + e_rectale_fd_core_dadi_dfe_plot +
e_eligens_fd_accessory_dadi_dfe_plot + e_rectale_fd_accessory_dadi_dfe_plot +
e_siraeum_fd_core_dadi_dfe_plot + r_bromii_fd_core_dadi_dfe_plot +
e_siraeum_fd_accessory_dadi_dfe_plot + r_bromii_fd_accessory_dadi_dfe_plot +
plot_layout(ncol=2)
ggsave(filename='./FD_core_accessory_dadi_DFE_reduced.png',
plot=FD_core_accessory_dadi_DFE_reduced,
width=20, height=40, units="in", limitsize=FALSE, dpi=300)
demography_core_file_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/two_epoch_demography.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/two_epoch_demography.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/two_epoch_demography.txt'
)
acc_core_dfe_comparison = numeric(18)
acc_core_dfe_comparison_constant_s = numeric(18)
core_mean_s = numeric(18)
core_mean_2ns = numeric(18)
acc_mean_s = numeric(18)
acc_mean_2ns = numeric(18)
for (i in 1:length(core_acc_species_list)) {
acc_core_dfe_comparison[i] = cross_species_dfe_comparison(DFE_core_file_list[i], DFE_acc_file_list[i])
acc_core_dfe_comparison_constant_s[i] = cross_species_dfe_comparison(DFE_core_file_list_constant_s[i], DFE_acc_file_list_constant_s[i])
core_mean_s[i] = compute_selection_coefficients(DFE_core_file_list[i])
core_mean_2ns[i] = nanc_from_demography(demography_core_file_list[i]) * core_mean_s[i]
acc_mean_s[i] = compute_selection_coefficients(DFE_acc_file_list[i])
acc_mean_2ns = nanc_from_demography(demography_acc_file_list[i]) * acc_mean_s[i]
}
demography_core_file_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/two_epoch_demography.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/two_epoch_demography.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/two_epoch_demography.txt'
)
demography_acc_file_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_two_epoch_demography.txt'
)
for (i in 1:length(core_acc_species_list)) {
acc_core_dfe_comparison[i] = cross_species_dfe_comparison(DFE_core_file_list[i], DFE_acc_file_list[i])
acc_core_dfe_comparison_constant_s[i] = cross_species_dfe_comparison(DFE_core_file_list_constant_s[i], DFE_acc_file_list_constant_s[i])
core_mean_s[i] = compute_selection_coefficients(DFE_core_file_list[i])
core_mean_2ns[i] = nanc_from_demography(demography_core_file_list[i]) * core_mean_s[i]
acc_mean_s[i] = compute_selection_coefficients(DFE_acc_file_list[i])
acc_mean_2ns = nanc_from_demography(demography_acc_file_list[i]) * acc_mean_s[i]
}
for (i in 1:length(core_acc_species_list)) {
acc_core_dfe_comparison[i] = cross_species_dfe_comparison(DFE_core_file_list[i], DFE_acc_file_list[i])
acc_core_dfe_comparison_constant_s[i] = cross_species_dfe_comparison(DFE_core_file_list_constant_s[i], DFE_acc_file_list_constant_s[i])
core_mean_s[i] = compute_selection_coefficients(DFE_core_file_list[i])[1]
core_mean_2ns[i] = nanc_from_demography(demography_core_file_list[i]) * core_mean_s[i]
acc_mean_s[i] = compute_selection_coefficients(DFE_acc_file_list[i])[1]
acc_mean_2ns = nanc_from_demography(demography_acc_file_list[i]) * acc_mean_s[i]
}
acc_core_dfe_comparison = numeric(18)
acc_core_dfe_comparison_constant_s = numeric(18)
core_mean_s = numeric(18)
core_mean_2ns = numeric(18)
acc_mean_s = numeric(18)
acc_mean_2ns = numeric(18)
for (i in 1:length(core_acc_species_list)) {
acc_core_dfe_comparison[i] = cross_species_dfe_comparison(DFE_core_file_list[i], DFE_acc_file_list[i])
acc_core_dfe_comparison_constant_s[i] = cross_species_dfe_comparison(DFE_core_file_list_constant_s[i], DFE_acc_file_list_constant_s[i])
core_mean_s[i] = compute_selection_coefficients(DFE_core_file_list[i])[1]
core_mean_2ns[i] = nanc_from_demography(demography_core_file_list[i]) * core_mean_s[i]
acc_mean_s[i] = compute_selection_coefficients(DFE_acc_file_list[i])[1]
acc_mean_2ns[i] = nanc_from_demography(demography_acc_file_list[i]) * acc_mean_s[i]
}
nanc_from_demography(demography_core_file_list[i])
compute_selection_coefficients(DFE_core_file_list[i])[1]
