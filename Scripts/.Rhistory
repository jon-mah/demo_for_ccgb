guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
supplementary_demography_scatter
supplementary_demography_scatter = ggscatter(supplementary_demography_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(nu_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=3) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
supplementary_demography_scatter
temp_supp_df = supplementary_demography_df[which(supplementary_demography_df$species %in% shared_species_list), ]
# Supplemental Figure 9
shared_species_list = c(
'Akkermansia muciniphila',
'Alistipes finegoldii',
'Alistipes onderdonkii',
'Alistipes shahii',
'Bacteroides caccae',
'Bacteroides cellulosilyticus',
'Bacteroides fragilis',
'Bacteroides stercoris',
'Bacteroides thetaiotaomicron',
'Bacteroides vulgatus',
'Barnesiella intestinihominis',
'Dialister invisus',
'Eubacterium rectale',
'Oscillibacter sp.',
'Parabacteroides distasonis',
'Parabacteroides merdae',
'Ruminococcus bicirculans',
'Ruminococcus bromii'
)
supplementary_demography_df = data.frame(species=supplementary_species_list,
nu_mle = numeric(39),
time_mle = numeric(39)
)
for (i in 1:length(supplementary_species_list)) {
# nu_mle
supplementary_demography_df[i, 2] = return_nu_mle(core_likelihood_surface_file_list[i])
# tau_mle
supplementary_demography_df[i, 3] = return_time_mle(core_likelihood_surface_file_list[i],
core_synonymous_sfs_file_list[i],
core_two_epoch_file_list[i])
}
supplementary_demography_df
options(ggrepel.max.overlaps = Inf)
supplementary_demography_scatter = ggscatter(supplementary_demography_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(nu_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=3) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
supplementary_demography_scatter
temp_supp_df = supplementary_demography_df[which(supplementary_demography_df$species %in% shared_species_list), ]
temp_supplementary_demography_scatter = ggscatter(temp_supp_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(x_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=4) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
temp_supplementary_demography_scatter = ggscatter(temp_supp_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(nu_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=4) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
temp_supplementary_demography_scatter
plot_build <- ggplot_build(temp_supplementary_demography_scatter)
color_mapping <- plot_build$data[[1]]$colour
print(color_mapping)
difference_plot =
temp_supplementary_demography_scatter +
geom_segment(aes(x=temp_supp_df$nu_mle, y=temp_supp_df$time_mle,
xend=hr_demography_df$nu_mle, yend=hr_demography_df$time_mle),
linejoin='round',
lineend='round',
linetype=1,
color=color_mapping,
arrow = arrow(length=unit(0.2, 'cm'))) +
# geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=4) +
ggtitle('Change in demography from full data to high recombination')
difference_plot
FD_accessory_phylogenetic_levels
# Supplemental Figure 9
shared_species_list = FD_accessory_phylogenetic_levels
fd_accessory_likelihood_surface_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_likelihood_surface.csv'
)
accessory_demography_df = data.frame(species=shared_species_list,
nu_mle = numeric(18),
time_mle = numeric(18)
)
for (i in 1:length(shared_species_list)) {
# nu_mle
hr_demography_df[i, 2] = return_nu_mle(hr_likelihood_surface_list[i])
# tau_mle
hr_demography_df[i, 3] = return_time_mle(hr_likelihood_surface_list[i],
hr_sfs_list[i],
hr_demography_file_list[i])
}
fd_accessory_likelihood_surface_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_likelihood_surface.csv'
)
fd_accessory_sfs_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_empirical_syn_downsampled_sfs.txt'
)
fd_accessory_demography_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_two_epoch_demography.txt'
)
accessory_demography_df = data.frame(species=shared_species_list,
nu_mle = numeric(18),
time_mle = numeric(18)
)
for (i in 1:length(shared_species_list)) {
# nu_mle
accessory_demography_df[i, 2] = return_nu_mle(fd_accessory_likelihood_surface_list[i])
# tau_mle
accessory_demography_df[i, 3] = return_time_mle(fd_accessory_likelihood_surface_list[i],
fd_accessory_sfs_list[i],
fd_accessory_demography_file_list[i])
}
for (i in 1:length(shared_species_list)) {
# nu_mle
accessory_demography_df[i, 2] = return_nu_mle(fd_accessory_likelihood_surface_list[i])
# tau_mle
accessory_demography_df[i, 3] = return_time_mle(fd_accessory_likelihood_surface_list[i],
fd_accessory_sfs_list[i],
fd_accessory_demography_list[i])
}
accessory_demography_df
options(ggrepel.max.overlaps = Inf)
supplementary_demography_scatter = ggscatter(supplementary_demography_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(nu_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=3) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
supplementary_demography_scatter
temp_supp_df = supplementary_demography_df[which(supplementary_demography_df$species %in% shared_species_list), ]
temp_supplementary_demography_scatter = ggscatter(temp_supp_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(nu_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=4) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
temp_supplementary_demography_scatter
plot_build <- ggplot_build(temp_supplementary_demography_scatter)
color_mapping <- plot_build$data[[1]]$colour
print(color_mapping)
difference_plot =
temp_supplementary_demography_scatter +
geom_segment(aes(x=temp_supp_df$nu_mle, y=temp_supp_df$time_mle,
xend=accessory_demography_df$nu_mle, yend=accessory_demography_df$time_mle),
linejoin='round',
lineend='round',
linetype=1,
color=color_mapping,
arrow = arrow(length=unit(0.2, 'cm'))) +
# geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=4) +
ggtitle('Core gene to accessory gene demography')
difference_plot
accessory_demography
accessory_demography_df
temp_supplementary_demography_df
temp_supplementary_df
temp_supp_df
supplementary_demography_df$species
accessory_demography_df$species
temp_supp_df$species
FD_accessory_phylogenetic_levels = c(
'Alistipes putredinis',
'Alistipes finegoldii',
'Alistipes onderdonkii',
'Alistipes shahii',
'Bacteroidales bacterium',
'Parabacteroides distasonis',
'Parabacteroides merdae',
'Bacteroides cellulosilyticus',
'Bacteroides stercoris',
'Bacteroides thetaiotaomicron',
'Bacteroides caccae',
'Bacteroides massiliensis',
'Bacteroides vulgatus',
'Dialister invisus',
'Eubacterium eligens',
'Eubacterium rectale',
'Eubacterium siraeum',
'Ruminococcus bromii'
)
FD_accessory_phylogenetic_levels_MIDAS = c(
'Alistipes_putredinis_61533',
'Alistipes_finegoldii_56071',
'Alistipes_onderdonkii_55464',
'Alistipes_shahii_62199',
'Bacteroidales_bacterium_58650',
'Parabacteroides_distasonis_56985',
'Parabacteroides_merdae_56972',
'Bacteroides_cellulosilyticus_58046',
'Bacteroides_stercoris_56735',
'Bacteroides_thetaiotaomicron_56941',
'Bacteroides_caccae_53434',
'Bacteroides_massiliensis_44749',
'Bacteroides_vulgatus_57955',
'Dialister_invisus_61905',
'Eubacterium_eligens_61678',
'Eubacterium_rectale_56927',
'Eubacterium_siraeum_57634',
'Ruminococcus_bromii_62047'
)
# Supplemental Figure 9
shared_species_list = FD_accessory_phylogenetic_levels
supplementary_demography_df = data.frame(species=supplementary_species_list,
nu_mle = numeric(39),
time_mle = numeric(39)
)
for (i in 1:length(supplementary_species_list)) {
# nu_mle
supplementary_demography_df[i, 2] = return_nu_mle(core_likelihood_surface_file_list[i])
# tau_mle
supplementary_demography_df[i, 3] = return_time_mle(core_likelihood_surface_file_list[i],
core_synonymous_sfs_file_list[i],
core_two_epoch_file_list[i])
}
supplementary_demography_df
fd_accessory_likelihood_surface_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_likelihood_surface.csv',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_likelihood_surface.csv'
)
fd_accessory_sfs_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_empirical_syn_downsampled_sfs.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_empirical_syn_downsampled_sfs.txt'
)
fd_accessory_demography_list = c(
'../SupplementaryAnalysis/Alistipes_putredinis_61533/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_finegoldii_56071/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_onderdonkii_55464/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Alistipes_shahii_62199/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroidales_bacterium_58650/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_distasonis_56985/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Parabacteroides_merdae_56972/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_cellulosilyticus_58046/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_stercoris_56735/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_thetaiotaomicron_56941/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_caccae_53434/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_massiliensis_44749/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Bacteroides_vulgatus_57955/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Dialister_invisus_61905/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_eligens_61678/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_rectale_56927/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Eubacterium_siraeum_57634/accessory_two_epoch_demography.txt',
'../SupplementaryAnalysis/Ruminococcus_bromii_62047/accessory_two_epoch_demography.txt'
)
accessory_demography_df = data.frame(species=shared_species_list,
nu_mle = numeric(18),
time_mle = numeric(18)
)
for (i in 1:length(shared_species_list)) {
# nu_mle
accessory_demography_df[i, 2] = return_nu_mle(fd_accessory_likelihood_surface_list[i])
# tau_mle
accessory_demography_df[i, 3] = return_time_mle(fd_accessory_likelihood_surface_list[i],
fd_accessory_sfs_list[i],
fd_accessory_demography_list[i])
}
accessory_demography_df
options(ggrepel.max.overlaps = Inf)
supplementary_demography_scatter = ggscatter(supplementary_demography_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(nu_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=3) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
supplementary_demography_scatter
temp_supp_df = supplementary_demography_df[which(supplementary_demography_df$species %in% shared_species_list), ]
temp_supplementary_demography_scatter = ggscatter(temp_supp_df, x="nu_mle", y="time_mle", color='species', size=3) +
ylab('Estimated time in years since most recent demographic event') +
xlab(nu_label_text) +
geom_vline(xintercept=1.0, color='red', linewidth=1, linetype='dashed') +
scale_shape_manual(name = "Best-Fit Demographic Model",
labels = c("Three Epoch", "Two Epoch"),
values = c(17, 19)) +
geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=4) +
guides(color=guide_legend(title="Species")) +
scale_x_log10(limits=c(1e-2, 2e5)) +
scale_y_log10(limits=c(2e2, 1e7)) +
theme(legend.position = 'none') +
guides(color = 'none') +
guides(shape = 'none')  +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=16))
temp_supplementary_demography_scatter
plot_build <- ggplot_build(temp_supplementary_demography_scatter)
color_mapping <- plot_build$data[[1]]$colour
print(color_mapping)
difference_plot =
temp_supplementary_demography_scatter +
geom_segment(aes(x=temp_supp_df$nu_mle, y=temp_supp_df$time_mle,
xend=accessory_demography_df$nu_mle, yend=accessory_demography_df$time_mle),
linejoin='round',
lineend='round',
linetype=1,
color=color_mapping,
arrow = arrow(length=unit(0.2, 'cm'))) +
# geom_text_repel(aes(label = species, color=species, fontface = 'italic'), size=4) +
ggtitle('Core gene to accessory gene demography')
difference_plot
# Supplemental Figure 11
N_anc = table_s3$`Two.epoch..Ancestral.effective.population.size`
N_curr_low = nu_tau_distribution$`nu_low` * N_anc
N_curr_high = nu_tau_distribution$`nu_high` * N_anc
N_curr_MLE = nu_tau_distribution$`nu_mle` * N_anc
N_curr_data = data.frame(
species=FD_phylogenetic_levels,
N_curr_MLE = N_curr_MLE,
N_curr_low = N_curr_low,
N_curr_high = N_curr_high
)
N_curr_label = expression(N[current])
N_curr_data$species = factor(N_curr_data$species, levels=phylogenetic_levels)
N_curr_data$species = factor(N_curr_data$species, levels=FD_phylogenetic_levels)
plot_N_curr_distribution = ggplot() +
geom_linerange(data=N_curr_data, mapping=aes(x=fct_rev(species), ymin=N_curr_low, ymax=N_curr_high, col=species), size=1, show.legend=FALSE) +
geom_point(data=N_curr_data, mapping=aes(x=fct_rev(species), y=N_curr_MLE, col=species), size=3, shape=18, show.legend=FALSE) +
scale_y_log10() +
coord_flip() +
theme_bw() +
xlab('') +
ylab(N_curr_label) +
theme(axis.text.y = element_text(face='italic')) +
theme(axis.text.y = element_text(hjust=0)) +
theme(axis.text=element_text(size=16)) +
theme(axis.title=element_text(size=16,face="bold"))
png("../Supplement/Supplemental_Figure_11A.png", width = 800, height = 1200)
# 800 x 1200 dimensions of saved image
plot_N_curr_distribution
dev.off()
