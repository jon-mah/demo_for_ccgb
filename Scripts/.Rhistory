geom_bar(stat = 'identity') +
labs(title = 'Third quartile of recombination rate by species',
x='Species',
y='Recombination events / base pair of core genome') +
coord_flip() +
ylim(0, 0.03) +
theme_minimal()
ggplot(recombination_percentiles_df, aes(x=reorder(species, ratio), y=ratio)) +
geom_bar(stat = 'identity') +
labs(title = '75th percentile divided by 25th percentile recombination rate by species',
x='Species',
y='Ratio of third and first quantile recombination rates') +
coord_flip() +
theme_minimal()
# Plot DFE Grid
DFE_grid_file_list = c(
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_sp_60764_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_finegoldii_56071_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_onderdonkii_55464_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_shahii_62199_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_putredinis_61533_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroidales_bacterium_58650_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Odoribacter_splanchnicus_62174_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_distasonis_56985_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_merdae_56972_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Prevotella_copri_61740_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_fragilis_54507_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_cellulosilyticus_58046_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_eggerthii_54457_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_stercoris_56735_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_uniformis_57318_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_thetaiotaomicron_56941_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_xylanisolvens_57185_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_caccae_53434_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_massiliensis_44749_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_vulgatus_57955_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_plebeius_61623_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_coprocola_61586_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Barnesiella_intestinihominis_62208_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Akkermansia_muciniphila_55290_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Dialister_invisus_61905_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Phascolarctobacterium_sp_59817_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_eligens_61678_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_rectale_56927_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Roseburia_inulinivorans_61943_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Roseburia_intestinalis_56239_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Lachnospiraceae_bacterium_51870_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Coprococcus_sp_62244_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Oscillibacter_sp_60799_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Ruminococcus_bromii_62047_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Ruminococcus_bicirculans_59300_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_siraeum_57634_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Faecalibacterium_prausnitzii_57453_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Faecalibacterium_prausnitzii_62201_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Faecalibacterium_prausnitzii_61481_likelihood_surface.csv'
)
# for (species in DFE_grid_file_list) {
#   print(species)s
#   find_dfe_mle(species)
# }
#
# cross_species_dfe_comparison(
#   DFE_grid_file_list[1],
#   DFE_grid_file_list[2]
# )
# dfe_comparison_matrix = matrix(, nrow=39, ncol=39)
#
# for (i in 1:39) {
#   for (j in i:39) {  # This change ensures only the upper right triangle is compared
#     print(DFE_grid_file_list[i])
#     print(DFE_grid_file_list[j])
#     comparison = cross_species_dfe_comparison(DFE_grid_file_list[i], DFE_grid_file_list[j])
#     print(comparison)
#     dfe_comparison_matrix[i, j] = comparison
#     dfe_comparison_matrix[j, i] = comparison  # Mirror the value across the diagonal
#   }
# }
DFE_grid_file_list_constant_s = c(
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_sp_60764_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_finegoldii_56071_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_onderdonkii_55464_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_shahii_62199_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_putredinis_61533_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroidales_bacterium_58650_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Odoribacter_splanchnicus_62174_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_distasonis_56985_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_merdae_56972_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Prevotella_copri_61740_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_fragilis_54507_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_cellulosilyticus_58046_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_eggerthii_54457_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_stercoris_56735_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_uniformis_57318_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_thetaiotaomicron_56941_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_xylanisolvens_57185_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_caccae_53434_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_massiliensis_44749_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_vulgatus_57955_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_plebeius_61623_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_coprocola_61586_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Barnesiella_intestinihominis_62208_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Akkermansia_muciniphila_55290_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Dialister_invisus_61905_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Phascolarctobacterium_sp_59817_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_eligens_61678_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_rectale_56927_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Roseburia_inulinivorans_61943_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Roseburia_intestinalis_56239_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Lachnospiraceae_bacterium_51870_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Coprococcus_sp_62244_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Oscillibacter_sp_60799_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Ruminococcus_bromii_62047_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Ruminococcus_bicirculans_59300_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_siraeum_57634_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Faecalibacterium_prausnitzii_57453_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Faecalibacterium_prausnitzii_62201_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Faecalibacterium_prausnitzii_61481_constant_s_likelihood_surface.csv'
)
# for (species in DFE_grid_file_list_constant_s) {
#   print(species)
#   find_dfe_mle(species)
# }
#
# cross_species_dfe_comparison(
#   DFE_grid_file_list_constant_s[1],
#   DFE_grid_file_list_constant_s[2]
# )
dfe_constant_s_matrix = matrix(, nrow=39, ncol=39)
# for (i in 1:39) {
#   for (j in i:39) {  # This change ensures only the upper right triangle is compared
#     print(DFE_grid_file_list_constant_s[i])
#     print(DFE_grid_file_list_constant_s[j])
#     comparison = cross_species_dfe_comparison(DFE_grid_file_list_constant_s[i], DFE_grid_file_list_constant_s[j])
#     print(comparison)
#     dfe_constant_s_matrix[i, j] = comparison
#     dfe_constant_s_matrix[j, i] = comparison  # Mirror the value across the diagonal
#   }
# }
# HR comparison
HR_DFE_grid_file_list = c(
'../HighRecombinationAnalysis/cross_species_dfe/Akkermansia_muciniphila_55290_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Alistipes_finegoldii_56071_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Alistipes_onderdonkii_55464_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Alistipes_shahii_62199_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_caccae_53434_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_cellulosilyticus_58046_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_fragilis_54507_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_stercoris_56735_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_thetaiotaomicron_56941_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_vulgatus_57955_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Barnesiella_intestinihominis_62208_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Dialister_invisus_61905_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Eubacterium_rectale_56927_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Oscillibacter_sp_60799_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Parabacteroides_distasonis_56985_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Parabacteroides_merdae_56972_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Ruminococcus_bicirculans_59300_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Ruminococcus_bromii_62047_likelihood_surface.csv'
)
# for (species in HR_DFE_grid_file_list) {
#   print(species)
#   find_dfe_mle(species)
# }
#
# cross_species_dfe_comparison(
#   HR_DFE_grid_file_list[1],
#   HR_DFE_grid_file_list[2]
# )
HR_dfe_comparison_matrix = matrix(, nrow=18, ncol=18)
# for (i in 1:18) {
#   for (j in i:18) {  # This change ensures only the upper right triangle is compared
#     print(HR_DFE_grid_file_list[i])
#     print(HR_DFE_grid_file_list[j])
#     comparison = cross_species_dfe_comparison(HR_DFE_grid_file_list[i], HR_DFE_grid_file_list[j])
#     print(comparison)
#     HR_dfe_comparison_matrix[i, j] = comparison
#     HR_dfe_comparison_matrix[j, i] = comparison  # Mirror the value across the diagonal
#   }
# }
# HR comparison
HR_DFE_grid_file_list_constant_s = c(
'../HighRecombinationAnalysis/cross_species_dfe/Akkermansia_muciniphila_55290_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Alistipes_finegoldii_56071_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Alistipes_onderdonkii_55464_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Alistipes_shahii_62199_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_caccae_53434_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_cellulosilyticus_58046_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_fragilis_54507_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_stercoris_56735_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_thetaiotaomicron_56941_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Bacteroides_vulgatus_57955_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Barnesiella_intestinihominis_62208_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Dialister_invisus_61905_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Eubacterium_rectale_56927_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Oscillibacter_sp_60799_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Parabacteroides_distasonis_56985_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Parabacteroides_merdae_56972_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Ruminococcus_bicirculans_59300_constant_s_likelihood_surface.csv',
'../HighRecombinationAnalysis/cross_species_dfe/Ruminococcus_bromii_62047_constant_s_likelihood_surface.csv'
)
# for (species in HR_DFE_grid_file_list_constant_s) {
#   print(species)
#   find_dfe_mle(species)
# }
# cross_species_dfe_comparison(
#   HR_DFE_grid_file_list_constant_s[1],
#   HR_DFE_grid_file_list_constant_s[2]
# )
HR_dfe_comparison_matrix_constant_s = matrix(, nrow=18, ncol=18)
# for (i in 1:18) {
#   for (j in i:18) {  # This change ensures only the upper right triangle is compared
#     print(HR_DFE_grid_file_list_constant_s[i])
#     print(HR_DFE_grid_file_list_constant_s[j])
#     comparison = cross_species_dfe_comparison(HR_DFE_grid_file_list_constant_s[i], HR_DFE_grid_file_list_constant_s[j])
#     print(comparison)
#     HR_dfe_comparison_matrix_constant_s[i, j] = comparison
#     HR_dfe_comparison_matrix_constant_s[j, i] = comparison  # Mirror the value across the diagonal
#   }
# }
# write.csv(dfe_comparison_matrix, '../SupplementaryAnalysis/cross_species_dfe/dfe_comparison_matrix.csv')
# write.csv(HR_dfe_comparison_matrix, '../HighRecombinationAnalysis/cross_species_dfe/dfe_comparison_matrix.csv')
# write.csv(accessory_dfe_comparison_matrix, '../SupplementaryAnalysis/cross_species_dfe/accessory_dfe_comparison_matrix.csv')
# write.csv(dfe_constant_s_matrix, '../SupplementaryAnalysis/cross_species_dfe/dfe_constant_s_matrix.csv')
# write.csv(HR_dfe_comparison_matrix_constant_s, '../HighRecombinationAnalysis/cross_species_dfe/dfe_constant_s_matrix.csv')
# write.csv(accessory_dfe_constant_s_matrix, '../SupplementaryAnalysis/cross_species_dfe/accessory_dfe_constant_s_matrix.csv')
dfe_comparison_matrix = read.table('../SupplementaryAnalysis/cross_species_dfe/dfe_comparison_matrix.csv', header=TRUE, row.names=NULL, sep=',')[, -c(1)]
dfe_constant_s_matrix = read.table('../SupplementaryAnalysis/cross_species_dfe/dfe_constant_s_matrix.csv', header=TRUE, row.names=NULL, sep=',')[, -c(1)]
# accessory_dfe_comparison_matrix = read.table('../SupplementaryAnalysis/cross_species_dfe/accessory_dfe_comparison_matrix.csv', header=TRUE, row.names=NULL, sep=',')[, -c(1)]
# accessory_dfe_constant_s_matrix = read.table('../SupplementaryAnalysis/cross_species_dfe/accessory_dfe_constant_s_matrix.csv', header=TRUE, row.names=NULL, sep=',')[, -c(1)]
HR_dfe_comparison_matrix = read.table('../HighRecombinationAnalysis/cross_species_dfe/dfe_comparison_matrix.csv', header=TRUE, row.names=NULL, sep=',')[, -c(1)]
HR_dfe_constant_s_matrix = read.table('../HighRecombinationAnalysis/cross_species_dfe/dfe_constant_s_matrix.csv', header=TRUE, row.names=NULL, sep=',')[, -c(1)]
# HR_dfe_comparison_matrix = dfe_comparison_matrix[-c(4, ), -c()]
# any(FD_species_subtree)
# row.names(dfe_comparison_matrix) = FD_species_subtree
# colnames(dfe_comparison_matrix) = FD_species_subtree
### 2ns DFE comparison within-vs-between genera (Core genes)
names(dfe_comparison_matrix)
FD_alistipes = c(2, 3, 4, 5, 6)
FD_bacteroides = c(8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19)
FD_eubacterium = c(23, 24, 25)
FD_faecalibacterium = c(26, 27, 28)
FD_parabacteroides = c(32, 33)
FD_roseburia = c(36, 37)
FD_ruminococcus = c(38, 39)
sum(dfe_comparison_matrix > 19.20747) / 2
sum(dfe_comparison_matrix[lower.tri(dfe_comparison_matrix)] > 19.20747)
sum(dfe_comparison_matrix[FD_alistipes, FD_alistipes] > 19.20747) / 2
# 6
sum(dfe_comparison_matrix[FD_bacteroides, FD_bacteroides] > 19.20747) / 2
# 31
sum(dfe_comparison_matrix[FD_eubacterium, FD_eubacterium] > 19.20747) / 2
# 0
sum(dfe_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium] > 19.20747) / 2
# 2
sum(dfe_comparison_matrix[FD_parabacteroides, FD_parabacteroides] > 19.20747) / 2
# 0
sum(dfe_comparison_matrix[FD_roseburia, FD_roseburia] > 19.20747) / 2
# 1
sum(dfe_comparison_matrix[FD_ruminococcus, FD_ruminococcus] > 19.20747 / 2)
# 0
core_2ns_within_genera_LRT = c()
core_2ns_within_genera_LRT = c(core_2ns_within_genera_LRT, dfe_comparison_matrix[FD_alistipes, FD_alistipes][lower.tri(dfe_comparison_matrix[FD_alistipes, FD_alistipes])])
core_2ns_within_genera_LRT = c(core_2ns_within_genera_LRT, dfe_comparison_matrix[FD_bacteroides, FD_bacteroides][lower.tri(dfe_comparison_matrix[FD_bacteroides, FD_bacteroides])])
core_2ns_within_genera_LRT = c(core_2ns_within_genera_LRT, dfe_comparison_matrix[FD_eubacterium, FD_eubacterium][lower.tri(dfe_comparison_matrix[FD_eubacterium, FD_eubacterium])])
core_2ns_within_genera_LRT = c(core_2ns_within_genera_LRT, dfe_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium][lower.tri(dfe_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium])])
core_2ns_within_genera_LRT = c(core_2ns_within_genera_LRT, dfe_comparison_matrix[FD_parabacteroides, FD_parabacteroides][lower.tri(dfe_comparison_matrix[FD_parabacteroides, FD_parabacteroides])])
core_2ns_within_genera_LRT = c(core_2ns_within_genera_LRT, dfe_comparison_matrix[FD_roseburia, FD_roseburia][lower.tri(dfe_comparison_matrix[FD_roseburia, FD_roseburia])])
core_2ns_within_genera_LRT = c(core_2ns_within_genera_LRT, dfe_comparison_matrix[FD_ruminococcus, FD_ruminococcus][lower.tri(dfe_comparison_matrix[FD_ruminococcus, FD_ruminococcus])])
length(core_2ns_within_genera_LRT) # 85 total within-genera comparisons
sum(core_2ns_within_genera_LRT > 19.20747) # 40 within genera are significant
core_2ns_between_genera_LRT = dfe_comparison_matrix[lower.tri(dfe_comparison_matrix)][!dfe_comparison_matrix[lower.tri(dfe_comparison_matrix)] %in% core_2ns_within_genera_LRT]
LRT_list <- melt(list(within_genera = core_2ns_within_genera_LRT, between_genera = core_2ns_between_genera_LRT))
mean(core_2ns_within_genera_LRT)
mean(core_2ns_between_genera_LRT)
between_within_mean_diff = mean(core_2ns_between_genera_LRT) - mean(core_2ns_within_genera_LRT)
permutation_mean_diff = numeric(100000)
for (i in 1:100000) {
this_scramble_between = sample(LRT_list$value, size=656, replace=FALSE)
this_scramble_within = sample(LRT_list$value, size=85, replace=FALSE)
permutation_mean_diff[i] = mean(this_scramble_between) - mean(this_scramble_within)
}
permutation_mean_data = data.frame(permutation_mean_diff)
names(permutation_mean_data) = c('value')
sum(between_within_mean_diff > permutation_mean_data) / 100000
quantile_label = "Proportion of area:"
quantile_label = paste(quantile_label, sum(between_within_mean_diff > permutation_mean_data) / 100000, sep=' ')
permutation_LRT = ggplot(permutation_mean_data, aes(x=value, y=..count..)) +
geom_histogram(bins=100) +
xlab('Difference of mean LRT statistics') +
ylab('Number of simulations') +
geom_vline(xintercept = between_within_mean_diff, color='green', linetype='dotted', linewidth=3) +
theme_minimal() +
ggtitle('Simulated difference of mean LRT statistics') +
annotate("text", x=25, y=2500, label= quantile_label, size=5) +
theme(axis.title=element_text(size=18)) +
theme(plot.title=element_text(size=20))
ggsave('../Summary/permutation_LRT.svg', permutation_LRT, width=18, height=12, dpi=600)
set.seed(1)
LRT_scramble_within_genera = sample(LRT_list$value, size=85, replace=FALSE)
LRT_scramble_between_genera = sample(LRT_list$value, size=656, replace=FALSE)
LRT_list <- melt(
list(
within_genera = core_2ns_within_genera_LRT, between_genera = core_2ns_between_genera_LRT, scrambled_within = LRT_scramble_within_genera, scrambled_between = LRT_scramble_between_genera
)
)
LRT_list$L1 = factor(LRT_list$L1, levels=c('between_genera', 'within_genera', 'scrambled_between', 'scrambled_within'))
comparison_1 = list(c("within_genera", "between_genera"))
comparison_2 = list(c("scrambled_between", "scrambled_within"))
comparison_3 = list(c("between_genera", "scrambled_between"))
comparison_4 = list(c("within_genera", "scrambled_within"))
my_comparisons <- list( c("within_genera", "between_genera"),
c("scrambled_between", "scrambled_within")
)
my_other_comparisons <- list( c("between_genera", "scrambled_between"),
c("within_genera", "scrambled_within"))
vertical_adjustments = c(0, -0.25, -0.5, -0.75)
LRT_distribution = ggplot(LRT_list, aes(x=L1, y=value, fill=L1)) +
geom_boxplot() +
ylab('LRT statistic') +
xlab('Comparison') +
scale_fill_manual(labels=c('Between-genera', 'Within-genera', 'Permutation test (within)', 'Permutation test (between)'),
breaks=c('between_genera', 'within_genera', 'scrambled_within', 'scrambled_between'),
values=c("#69b3a2", "#95fd34", 'black', 'grey'),) +
theme_minimal() +
theme(axis.text.x=element_blank(),) +
guides(fill=guide_legend(title="Type of DFE comparison")) +
ggtitle('LRT statistics for between-genera and within-genera DFE comparisons') +
geom_abline(intercept=19.20747, color='red', linetype='dashed') +
geom_signif(position='identity', size=1, y_position=750,
comparisons = comparison_1,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', size=1, y_position=850,
comparisons = comparison_2,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity',
comparisons = comparison_3, size=1, y_position=800,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
geom_signif(position='identity', size=1,
comparisons = comparison_4, y_position=900,
map_signif_level = function(x) paste("p =", scales::pvalue(x))) +
theme(axis.title=element_text(size=18)) +
theme(plot.title=element_text(size=20)) +
theme(legend.title=element_text(size=18)) +
theme(legend.text=element_text(size=16))
ggsave('../Summary/LRT_distribution.svg', LRT_distribution, width=18, height=12, dpi=600)
### s DFE comparison within-vs-between genera (Core genes)
sum(dfe_constant_s_matrix[lower.tri(dfe_constant_s_matrix)] > 19.20747)
# 344
sum(dfe_constant_s_matrix[FD_alistipes, FD_alistipes] > 19.20747) / 2
# 6
sum(dfe_constant_s_matrix[FD_bacteroides, FD_bacteroides] > 19.20747) / 2
# 38
sum(dfe_constant_s_matrix[FD_eubacterium, FD_eubacterium] > 19.20747) / 2
# 2
sum(dfe_constant_s_matrix[FD_faecalibacterium, FD_faecalibacterium] > 19.20747) / 2
# 1
sum(dfe_constant_s_matrix[FD_parabacteroides, FD_parabacteroides] > 19.20747) / 2
# 0
sum(dfe_constant_s_matrix[FD_roseburia, FD_roseburia] > 19.20747) / 2
# 1
sum(dfe_constant_s_matrix[FD_ruminococcus, FD_ruminococcus] > 19.20747 / 2)
# 2
### 2ns DFE comparison within-vs-between genera (Core genes)
sum(dfe_comparison_matrix[lower.tri(dfe_comparison_matrix)] > 19.20747)
# 344
sum(dfe_comparison_matrix[FD_alistipes, FD_alistipes] > 19.20747) / 2
# 6
sum(dfe_comparison_matrix[FD_bacteroides, FD_bacteroides] > 19.20747) / 2
# 36
sum(dfe_comparison_matrix[FD_eubacterium, FD_eubacterium] > 19.20747) / 2
# 3
sum(dfe_comparison_matrix[FD_faecalibacterium, FD_faecalibacterium] > 19.20747) / 2
# 2
sum(dfe_comparison_matrix[FD_parabacteroides, FD_parabacteroides] > 19.20747) / 2
# 1
sum(dfe_comparison_matrix[FD_roseburia, FD_roseburia] > 19.20747) / 2
# 0
sum(dfe_comparison_matrix[FD_ruminococcus, FD_ruminococcus] > 19.20747 / 2)
# 2
### s DFE comparison within-vs-between genera (Core genes, high recombination)
### s DFE comparison within-vs-between genera (Accessory genes)
row.names(dfe_comparison_matrix) = FD_phylogenetic_levels
colnames(dfe_comparison_matrix) = FD_phylogenetic_levels
dfe_comparison_matrix
# Critical value for FD. 471 unique comparisons
qchisq(1 - 0.05/471, df=2)
# Critical value for HR or for accessory. 153 unique comparisons
qchisq(1 - 0.05/153, df=2)
# Critical value for core vs. accessory DFE, 18 compmarisons
qchisq(1 - 0.05/18, df=2)
DFE_core_file_list = c(
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_putredinis_61533_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_finegoldii_56071_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_onderdonkii_55464_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_shahii_62199_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroidales_bacterium_58650_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_distasonis_56985_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_merdae_56972_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_cellulosilyticus_58046_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_stercoris_56735_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_thetaiotaomicron_56941_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_caccae_53434_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_massiliensis_44749_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_vulgatus_57955_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Dialister_invisus_61905_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_eligens_61678_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_rectale_56927_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_siraeum_57634_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Ruminococcus_bromii_62047_likelihood_surface.csv'
)
DFE_core_file_list_constant_s = c(
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_putredinis_61533_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_finegoldii_56071_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_onderdonkii_55464_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Alistipes_shahii_62199_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroidales_bacterium_58650_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_distasonis_56985_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Parabacteroides_merdae_56972_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_cellulosilyticus_58046_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_stercoris_56735_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_thetaiotaomicron_56941_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_caccae_53434_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_massiliensis_44749_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Bacteroides_vulgatus_57955_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Dialister_invisus_61905_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_eligens_61678_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_rectale_56927_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Eubacterium_siraeum_57634_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/cross_species_dfe/Ruminococcus_bromii_62047_constant_s_likelihood_surface.csv'
)
DFE_acc_file_list = c(
'../SupplementaryAnalysis/accessory_cross/Alistipes_putredinis_61533_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Alistipes_finegoldii_56071_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Alistipes_onderdonkii_55464_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Alistipes_shahii_62199_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Bacteroidales_bacterium_58650_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Parabacteroides_distasonis_56985_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Parabacteroides_merdae_56972_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Bacteroides_cellulosilyticus_58046_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Bacteroides_stercoris_56735_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Bacteroides_thetaiotaomicron_56941_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Bacteroides_caccae_53434_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Bacteroides_massiliensis_44749_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Bacteroides_vulgatus_57955_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Dialister_invisus_61905_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Eubacterium_eligens_61678_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Eubacterium_rectale_56927_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Eubacterium_siraeum_57634_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_cross/Ruminococcus_bromii_62047_likelihood_surface.csv'
)
DFE_acc_file_list_constant_s = c(
'../SupplementaryAnalysis/accessory_constant_s/Alistipes_putredinis_61533_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Alistipes_finegoldii_56071_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Alistipes_onderdonkii_55464_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Alistipes_shahii_62199_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Bacteroidales_bacterium_58650_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Parabacteroides_distasonis_56985_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Parabacteroides_merdae_56972_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Bacteroides_cellulosilyticus_58046_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Bacteroides_stercoris_56735_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Bacteroides_thetaiotaomicron_56941_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Bacteroides_caccae_53434_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Bacteroides_massiliensis_44749_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Bacteroides_vulgatus_57955_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Dialister_invisus_61905_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Eubacterium_eligens_61678_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Eubacterium_rectale_56927_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Eubacterium_siraeum_57634_constant_s_likelihood_surface.csv',
'../SupplementaryAnalysis/accessory_constant_s/Ruminococcus_bromii_62047_constant_s_likelihood_surface.csv'
)
core_acc_species_list = c(
'Alistipes putredinis',
'Alistipes finegoldii',
'Alistipes onderdonkii',
'Alistipes shahii',
'Bacteroidales bacterium',
'Parabacteroides distasonis',
'Parabacteroides merdae',
'Bacteroides cellulosilyticus',
'Bacteroides stercoris',
'Bacteroides thetaiotaomicron',
'Bacteroides caccae',
'Bacteroides massiliensis',
'Bacteroides vulgatus',
'Dialister invisus',
'Eubacterium eligens',
'Eubacterium rectale',
'Eubacterium siraeum',
'Ruminococcus bromii'
)
acc_core_dfe_comparison = numeric(18)
acc_core_dfe_comparison_constant_s = numeric(18)
for (i in 1:length(core_acc_species_list)) {
acc_core_dfe_comparison[i] = cross_species_dfe_comparison(DFE_core_file_list[i], DFE_acc_file_list[i])
acc_core_dfe_comparison_constant_s[i] = cross_species_dfe_comparison(DFE_core_file_list_constant_s[i], DFE_acc_file_list_constant_s[i])
}
for (i in 1:length(core_acc_species_list)) {
acc_core_dfe_comparison[i] = cross_species_dfe_comparison(DFE_core_file_list[i], DFE_acc_file_list[i])
acc_core_dfe_comparison_constant_s[i] = cross_species_dfe_comparison(DFE_core_file_list_constant_s[i], DFE_acc_file_list_constant_s[i])
}
acc_core_dfe_LRT_table = data.frame(species=core_acc_species_list, constant_2NAs=acc_core_dfe_comparison, constant_s=acc_core_dfe_comparison_constant_s)
acc_core_dfe_LRT_table
acc_core_dfe_comparison[1]
cross_species_dfe_comparison(DFE_core_file_list[1], DFE_acc_file_list[1])
DFE_core_file_list[1]
DFE_acc_file_list[1]
DFE_core_file_list_constant_s[1]
DFE_acc_file_list_constant_s[1]
write.csv(acc_core_dfe_LRT_table, '../Summary/core_acc_dfe_LRT.csv', row.names=FALSE)
cross_species_dfe_comparison(DFE_core_file_list_constant_s[1], DFE_acc_file_list_constant_s[1])
# Critical value for core vs. accessory DFE, 18 compmarisons
qchisq(1 - 0.05/18, df=2)
